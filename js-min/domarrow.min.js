(()=>{function getNumberOrDef(val,def){return"number"!=typeof val||isNaN(val)?def:val}function isVisible(element){return element&&"hidden"!==element.style.visibility}function inside(minX,minY,maxX,maxY,x1,y1){return minX<=x1&&x1<=maxX&&minY<=y1&&y1<=maxY}function intersectionPoint(x1,y1,x2,y2,minX,minY,maxX,maxY){var min=Math.min,max=Math.max,good=inside.bind(null,min(x1,x2),min(y1,y2),max(x1,x2),max(y1,y2));if(x1<=minX&&x2<=minX||y1<=minY&&y2<=minY||x1>=maxX&&x2>=maxX||y1>=maxY&&y2>=maxY||inside(minX,minY,maxX,maxY,x1,y1)&&inside(minX,minY,maxX,maxY,x2,y2))return null;var m=(y2-y1)/(x2-x1),y=m*(minX-x1)+y1;if(minY<y&&y<maxY&&good(minX,y))return{x:minX,y:y};if(minY<(y=m*(maxX-x1)+y1)&&y<maxY&&good(maxX,y))return{x:maxX,y:y};var x=(minY-y1)/m+x1;return minX<x&&x<maxX&&good(x,minY)?{x:x,y:minY}:minX<(x=(maxY-y1)/m+x1)&&x<maxX&&good(x,maxY)?{x:x,y:maxY}:null}function adjustLine(from,to,line,trafo){var color=trafo&&trafo.color||"black",W=trafo&&trafo.width||2,fromB=parseFloat(from.style.top)?null:from.getBoundingClientRect(),toB=parseFloat(to.style.top)?null:to.getBoundingClientRect(),fromBStartY=fromB?window.scrollY+fromB.top:parseFloat(from.style.top),fromBStartX=fromB?window.scrollX+fromB.left:parseFloat(from.style.left),toBStartY=toB?window.scrollY+toB.top:parseFloat(to.style.top),toBStartX=toB?window.scrollX+toB.left:parseFloat(to.style.left),fromBWidth=fromB?fromB.width:parseFloat(from.style.width)||from.offsetWidth,fromBHeight=fromB?fromB.height:parseFloat(from.style.height)||from.offsetHeight,toBWidth=toB?toB.width:parseFloat(to.style.width)||to.offsetWidth,toBHeight=toB?toB.height:parseFloat(to.style.height)||to.offsetHeight,fT=fromBStartY+fromBHeight*getNumberOrDef(trafo&&trafo.fromY,getNumberOrDef(trafo,.5)),tT=toBStartY+toBHeight*getNumberOrDef(trafo&&trafo.toY,getNumberOrDef(trafo,.5)),fL=fromBStartX+fromBWidth*getNumberOrDef(trafo&&trafo.fromX,getNumberOrDef(trafo,.5)),tL=toBStartX+toBWidth*getNumberOrDef(trafo&&trafo.toX,getNumberOrDef(trafo,.5)),CA=Math.abs(tT-fT),CO=Math.abs(tL-fL),H=Math.sqrt(CA*CA+CO*CO),ANG=180/Math.PI*Math.acos(CO/H);if((fT>=tT||fL>=tL)&&(tT>=fT||tL>=fL)&&(ANG*=-1),trafo&&trafo.onlyVisible){var arrangeFrom=intersectionPoint(fL,fT,tL,tT,fromBStartX,fromBStartY,fromBStartX+fromBWidth,fromBStartY+fromBHeight),arrangeTo=intersectionPoint(fL,fT,tL,tT,toBStartX,toBStartY,toBStartX+toBWidth,toBStartY+toBHeight);arrangeFrom&&(fL=arrangeFrom.x,fT=arrangeFrom.y),arrangeTo&&(tL=arrangeTo.x,tT=arrangeTo.y),CA=Math.abs(tT-fT),CO=Math.abs(tL-fL),H=Math.sqrt(CA*CA+CO*CO)}var top=(tT+fT)/2-W/2,left=(tL+fL)/2-H/2,arrows=[...line.getElementsByClassName("arrow")],needSwap=fL>tL||fL==tL&&fT<tT,arrowFw=needSwap&&isVisible(arrows[0])&&arrows[0]||!needSwap&&isVisible(arrows[1])&&arrows[1],arrowBw=!needSwap&&isVisible(arrows[0])&&arrows[0]||needSwap&&isVisible(arrows[1])&&arrows[1];arrowFw&&(arrowFw.classList.remove("arrow-bw"),arrowFw.classList.add("arrow-fw"),arrowFw.style.borderRightColor=color,arrowFw.style.top=W/2-6+"px"),arrowBw&&(arrowBw.classList.remove("arrow-fw"),arrowBw.classList.add("arrow-bw"),arrowBw.style.borderLeftColor=color,arrowBw.style.top=W/2-6+"px"),line.style.display="none",line.style["-webkit-transform"]="rotate("+ANG+"deg)",line.style["-moz-transform"]="rotate("+ANG+"deg)",line.style["-ms-transform"]="rotate("+ANG+"deg)",line.style["-o-transform"]="rotate("+ANG+"deg)",line.style["-transform"]="rotate("+ANG+"deg)",line.style.top=top+"px",line.style.left=left+"px",line.style.width=H+"px",line.style.height=W+"px",line.style.background="linear-gradient(to right, "+(arrowFw?"transparent":color)+" 11px, "+color+" 11px "+(H-11)+"px, "+(arrowBw?"transparent":color)+" "+(H-11)+"px 100%)",line.style.display="initial"}function repaintConnection(connectionElement){var fromQ=connectionElement.getAttribute("from"),fromE=document.querySelector(fromQ),toQ=connectionElement.getAttribute("to"),toE=document.querySelector(toQ);connectedObserver.observe(fromE,{attributes:!0}),connectedObserver.observe(toE,{attributes:!0});var lineE=connectionElement.getElementsByClassName("line")[0];lineE||((lineE=document.createElement("div")).classList.add("line"),connectionElement.appendChild(lineE));var needTail=connectionElement.hasAttribute("tail"),needHead=connectionElement.hasAttribute("head"),arrows=lineE.getElementsByClassName("arrow"),tail=arrows[0],head=arrows[1];tail||!needHead&&!needTail||((tail=document.createElement("div")).classList.add("arrow"),lineE.appendChild(tail)),!head&&needHead&&((head=document.createElement("div")).classList.add("arrow"),lineE.appendChild(head)),tail&&(tail.style.visibility=needTail?"visible":"hidden"),head&&(head.style.visibility=needHead?"visible":"hidden");var textE=lineE.getElementsByClassName("text")[0],textMessage=connectionElement.getAttribute("text");!textE&&textMessage&&((textE=document.createElement("div")).classList.add("text"),lineE.appendChild(textE)),textE&&textE.innerText!=textMessage&&(textE.innerText=textMessage),adjustLine(fromE,toE,lineE,{color:connectionElement.getAttribute("color"),onlyVisible:connectionElement.hasAttribute("onlyVisible"),fromX:parseFloat(connectionElement.getAttribute("fromX")),fromY:parseFloat(connectionElement.getAttribute("fromY")),toX:parseFloat(connectionElement.getAttribute("toX")),toY:parseFloat(connectionElement.getAttribute("toY")),width:parseFloat(connectionElement.getAttribute("width"))})}function repaintWithoutObserve(tag){connectionObserver.observe(tag,{attributeFilter:[]}),repaintConnection(tag),connectionObserver.observe(tag,{attributes:!0,childList:!0,subtree:!0})}function createOne(newElement){connectionElements.push(newElement),repaintConnection(newElement),connectionObserver.observe(newElement,{attributes:!0,childList:!0,subtree:!0})}function create(){bodyObserver.observe(document.body,{childList:!0,subtree:!0}),[...document.body.getElementsByTagName("connection")].forEach(createOne)}function removeConnection(tag){for(var i=connectionElements.length-1;i>=0;i--)connectionElements[i]===tag&&connectionElements.splice(i,1);connectionObserver.observe(tag,{attributeFilter:[]})}function changedConnectedTag(changes){changes.forEach(e=>{for(var changedElem=e.target,wasConnection=!1,i=0;i<connectionElements.length;++i){var fromE,toE;if(document.querySelector(connectionElements[i].getAttribute("from"))!==changedElem)document.querySelector(connectionElements[i].getAttribute("to"))===changedElem&&(wasConnection=!0,repaintWithoutObserve(connectionElements[i]));else wasConnection=!0,repaintWithoutObserve(connectionElements[i])}wasConnection||connectionObserver.observe(changedElem,{attributeFilter:[]})})}function changedConnectionTag(changes){changes.forEach(e=>{var conn=e.target;for("connection"!==conn.tagName.toLowerCase()&&e.attributeName;conn&&"connection"!==conn.tagName.toLowerCase();)conn=conn.parentElement;conn&&repaintWithoutObserve(conn)})}function bodyNewElement(changes){changes.forEach(e=>{e.removedNodes.forEach(n=>{n.tagName&&"connection"===n.tagName.toLowerCase()&&removeConnection(n)}),e.addedNodes.forEach(n=>{n.tagName&&"connection"===n.tagName.toLowerCase()&&createOne(n)})})}var connectionElements=[],MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,bodyObserver=new MutationObserver(bodyNewElement),connectionObserver=new MutationObserver(changedConnectionTag),connectedObserver=new MutationObserver(changedConnectedTag);document.body&&create()||window.addEventListener("load",create)})();